<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mr  Quiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center">

  <!-- โ ุงูููุฏุฑ -->
  <div class="bg-gradient-to-r from-purple-600 to-blue-500 text-center w-full max-w-3xl mt-6 p-6 rounded-3xl shadow-lg">
    <h1 class="text-3xl font-bold">Mr </h1>
    <p class="text-xl mt-2">Quiz</p>
  </div>

  <!-- โ ุงุฎุชูุงุฑ ุงูุตู ูุงูููู -->
  <div id="classSelection" class="text-center mt-10">
    <h2 class="text-2xl font-bold mb-4">ุงุฎุชุฑ ุงูุตู ุงูุฏุฑุงุณู ูุงูููู</h2>

    <!-- ูุงุฆูุฉ ุงูุตููู -->
    <select id="classSelect" class="text-black p-2 rounded mb-3">
      <option value="">-- ุงุฎุชุฑ ุงูุตู --</option>
      <option value="g1">ุฃููู ุฅุนุฏุงุฏู</option>
      <option value="g2">ุชุงููุฉ ุฅุนุฏุงุฏู</option>
      <option value="g3">ุชุงูุชุฉ ุฅุนุฏุงุฏู</option>
      <option value="s1">ุฃููู ุซุงููู</option>
      <option value="s2">ุชุงููุฉ ุซุงููู</option>
      <option value="s3">ุชุงูุชุฉ ุซุงููู</option>
    </select>

    <br>

    <!-- โ ูุงุฆูุฉ ุงูุฃูุงู ุงูุณุจุนุฉ -->
    <select id="daySelect" class="text-black p-2 rounded mb-2">
      <option value="">-- ุงุฎุชุฑ ุงูููู --</option>
      <option value="ุงูุณุจุช">ุงูุณุจุช</option>
      <option value="ุงูุฃุญุฏ">ุงูุฃุญุฏ</option>
      <option value="ุงูุฅุซููู">ุงูุฅุซููู</option>
      <option value="ุงูุซูุงุซุงุก">ุงูุซูุงุซุงุก</option>
      <option value="ุงูุฃุฑุจุนุงุก">ุงูุฃุฑุจุนุงุก</option>
      <option value="ุงูุฎููุณ">ุงูุฎููุณ</option>
      <option value="ุงูุฌูุนุฉ">ุงูุฌูุนุฉ</option>
    </select>

    <br>
    <button id="startBtn" class="bg-blue-600 px-4 py-2 rounded ml-2 transition hover:bg-blue-700">ุงุจุฏุฃ</button>
  </div>

  <!-- โ ุงููููุฒ -->
  <div id="quizSection" class="hidden w-full max-w-3xl mt-10">
    <div class="mb-4">
      <input id="studentName" placeholder="ุงูุงุณู" class="p-2 text-black rounded w-1/2 mb-2"><br>
      <input id="studentPhone" placeholder="ุฑูู ุงูุชููููู" class="p-2 text-black rounded w-1/2">
    </div>
    <form id="quizForm" class="space-y-4"></form>
    <button id="submitBtn" class="bg-green-600 px-4 py-2 rounded mt-4 transition hover:bg-green-700">ุฅุฑุณุงู</button>
    <div id="result" class="mt-6 text-xl font-bold"></div>
  </div>

  <!-- โ ูุงุชุณุงุจ -->
  <a href="https://wa.me/201225580865" target="_blank" class="fixed bottom-6 right-6 bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-full shadow-lg transition transform hover:scale-105">
    ๐ฌ ุชูุงุตู ูุน Mr 
  </a>

  <!-- โ ุงูููุชุฑ -->
  <a href="https://wa.me/201094724932" target="_blank" class="w-full flex flex-col items-center justify-center text-center mt-10 mb-4">
    <div class="bg-black text-white py-4 px-6 rounded-3xl shadow-lg w-64 hover:bg-gray-800 transition cursor-pointer">
      <p class="font-bold text-lg">ุตููู ุจูุงุณุทุฉ Boda</p>
      <p class="text-sm text-gray-300 mt-1">ุงููุฑ ููุชูุงุตู</p>
    </div>
  </a>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyQD5LaCzRD-8S7eD11G0MpeWHWOKmlhe9sU0wLvd8s4fciLW9R8BVpgBHlHMyVcD7qYw/exec";

    let questions = [];
    let selectedClass = "";

    const classNames = {
      g1: "ุฃููู ุฅุนุฏุงุฏู",
      g2: "ุชุงููุฉ ุฅุนุฏุงุฏู",
      g3: "ุชุงูุชุฉ ุฅุนุฏุงุฏู",
      s1: "ุฃููู ุซุงููู",
      s2: "ุชุงููุฉ ุซุงููู",
      s3: "ุชุงูุชุฉ ุซุงููู"
    };

    // โ ุชุญููู ุงูุฃุณุฆูุฉ
    document.getElementById("startBtn").addEventListener("click", async () => {
      selectedClass = document.getElementById("classSelect").value;
      const selectedDay = document.getElementById("daySelect").value;

      if (!selectedClass) return alert("ูู ูุถูู ุงุฎุชุฑ ุงูุตู ุงูุฏุฑุงุณู");
      if (!selectedDay) return alert("ูู ูุถูู ุงุฎุชุฑ ุงูููู");

      const btn = document.getElementById("startBtn");
      btn.disabled = true;
      btn.innerText = "ุฌุงุฑู ุงูุชุญููู...";

      try {
        const res = await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify({
            type: "getQuestions",
            classSheet: `questions_${selectedClass}`
          })
        });

        questions = await res.json();

        if (!Array.isArray(questions) || questions.length === 0) {
          alert("ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุณุฆูุฉ ููุฐุง ุงูุตู.");
          btn.disabled = false;
          btn.innerText = "ุงุจุฏุฃ";
          return;
        }

        showQuestions();
        document.getElementById("classSelection").classList.add("hidden");
        document.getElementById("quizSection").classList.remove("hidden");
      } catch (err) {
        alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุฃุณุฆูุฉ. ุชุฃูุฏ ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช.");
      }

      btn.disabled = false;
      btn.innerText = "ุงุจุฏุฃ";
    });

    // โ ุนุฑุถ ุงูุฃุณุฆูุฉ
    function showQuestions() {
      const form = document.getElementById("quizForm");
      form.innerHTML = "";
      questions.forEach(q => {
        let html = `
          <div class="card bg-gray-800 p-4 rounded-xl shadow-lg">
            <p class="font-bold mb-2">${q.question}</p>
            ${q.choices.map(c => `
              <label class="block cursor-pointer hover:text-blue-300">
                <input type="radio" name="${q.id}" value="${c}" class="mr-2"> ${c}
              </label>
            `).join("")}
          </div>
        `;
        form.innerHTML += html;
      });
    }

    // โ ุนูุฏ ุงูุฅุฑุณุงู
    document.getElementById("submitBtn").addEventListener("click", async (e) => {
      e.preventDefault();

      const name = document.getElementById("studentName").value.trim();
      const phone = document.getElementById("studentPhone").value.trim();
      const day = document.getElementById("daySelect").value;

      if (!name || !phone) return alert("ูู ูุถูู ุงูุชุจ ุงูุงุณู ูุฑูู ุงูุชููููู");
      if (!day) return alert("ูู ูุถูู ุงุฎุชุฑ ุงูููู ูุจู ุจุฏุก ุงูุงุฎุชุจุงุฑ");

      let score = 0, wrong = [], total = questions.length;

      questions.forEach(q => {
        const selected = document.querySelector(`input[name="${q.id}"]:checked`);
        const card = selected
          ? selected.closest(".card")
          : document.querySelector(`input[name="${q.id}"]`).closest(".card");
        const all = document.querySelectorAll(`input[name="${q.id}"]`);
        all.forEach(opt => {
          let label = opt.parentElement;
          label.style.color = "#fff";
          if (opt.value === q.correct) label.style.color = "lightgreen";
          if (selected && opt === selected && selected.value !== q.correct)
            label.style.color = "red";
        });

        if (selected && selected.value === q.correct) score++;
        else {
          wrong.push(q.id);
          if (!card.querySelector(".explanation")) {
            const exp = document.createElement("div");
            exp.classList.add("explanation", "mt-2", "text-yellow-300");
            exp.innerHTML = `<b>ุงูุดุฑุญ:</b> ${q.explanation}`;
            card.appendChild(exp);
          }
        }
      });

      document.getElementById("result").innerHTML = `
        <div class="bg-gray-800 p-4 rounded-xl mt-6">
          <p class="text-green-400 text-2xl font-bold">ูุชูุฌุชู: ${score} / ${total}</p>
        </div>
      `;

      try {
        await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify({
            type: "saveResult",
            className: classNames[selectedClass],
            day, // โ ุงูููู ุงููุฎุชุงุฑ
            name, phone, score, total, wrong
          })
        });
        alert("โ ุชู ุญูุธ ุงููุชูุฌุฉ ุจูุฌุงุญ!");
      } catch (err) {
        alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงููุชูุฌุฉ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.");
      }
    });
  </script>
</body>
</html>
